% extends 'pa_core/overview.html' %}

{% block title %}Notes{% endblock %}

{% block items %}
    <meta name="csrf-token" content="{{ csrf_token }}">

    <form method="get" action="{% url 'pa_note:search' %}">
        <input type="text" name="q" placeholder="Search notes..." value="{{ request.GET.q }}">
        <button type="submit">Search</button>
        {% if request.GET.q %}
            <!-- Кнопка для сброса поиска -->
            <a href="{% url 'pa_note:search' %}">Show all notes</a>
        {% endif %}
    </form>

    <a href="{% url 'pa_note:add_note' %}">Add note</a>

    <ul>
        {% for note in items %}
            <li>
                {{ note.name }} - {{ note.description }} -
                {% if note.done %}
                    Done
                {% else %}
                    Not done
                    <form
                        action="{% url 'pa_note:done_note' note.id %}"
                        method="post"
                        style="display:inline;"
                    >
                        {% csrf_token %}
                        <button type="submit">Mark as done</button>
                    </form>
                {% endif %}
                <a href="{% url 'pa_note:edit_note' note.id %}">Edit</a>

                <a
                    href="#"
                    onclick="confirmDelete('{% url 'pa_note:delete_note' note.id %}'); return false;"
                >
                    Delete
                </a>
            </li>
        {% endfor %}
    </ul>

    {% if items|length == 0 %}
        <p>Notes not found.</p>
    {% endif %}

    <script>
        function confirmDelete(url) {
            if (confirm('Are you sure you want to delete this note?')) {
                // Create a form to submit the delete request
                const form = document.createElement('form');
                form.method = 'post';
                form.action = url;

                // Add the CSRF token
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = '{{ csrf_token }}';
                form.appendChild(csrfInput);

                // Submit the form
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
{% endblock %}